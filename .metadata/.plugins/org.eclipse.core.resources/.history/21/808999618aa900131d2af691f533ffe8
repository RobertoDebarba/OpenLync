//Referencias:
//	
//	http://www.guj.com.br/articles/126

import java.io.BufferedReader;
import java.io.IOException;  
import java.io.InputStreamReader;
import java.io.PrintStream;  
import java.net.Socket;
import java.util.Scanner;

public class OpenLync_client {
	
	private static String ipServidor;
	private static int portaEntrada;
	private static int portaSaida; 
	private static String ipDestino;
	
	private static void IniciaVariaveis() {
		ipServidor = "192.168.152.1"; // Define ip do servidor
		portaEntrada = 7606;  //Define porta de entrada de dados; Servidor -> Cliente
		portaSaida = 7609;// Define porta de sáida de dados; Cliente -> Servidor
		
		// Define ip destino para comunicação
		System.out.print("Digite o ip com o qual deseja se comunicar: ");
		Scanner scan = new Scanner(System.in);
		ipDestino = scan.nextLine();  
		//scan.close(); FIXME
	}
	
	public OpenLync_client() {
		
	}

	public static void main(String[] args) throws IOException {
		
		IniciaVariaveis();
		
		// Instancia objeto que cuidará da entrada de dados e manda para uma thread
		EntradaDados ed = new EntradaDados(portaEntrada);
		new Thread(ed).start();
		
		// Cria objetos necessarios
        Socket socketSaida = null;  //TODO tentar enviar e receber pelo mesmo ServerSocket
        PrintStream PSsaida = null;  
        
        // ---------------------------------------------------------------------------------
		// Conecta ao socket
		try {
    	socketSaida = new Socket(ipServidor, portaSaida);  
    	System.out.println("Criada conexão com o servidor "+ipServidor+" pela porta "+portaSaida);
		} catch(IOException e) {
			System.out.println("Erro ao conectar com o servidor "+ipServidor+" pela porta "+portaSaida);
		}
    	
		// Cria printStream
    	try {
			PSsaida = new PrintStream(socketSaida.getOutputStream());
		} catch (IOException e) {
			System.out.println("Erro ao criar PrintStream de saída");
		} 
    	
    	// Manda novas mensagens
        System.out.print("Digite uma mensagem: ");
        @SuppressWarnings("resource")
		Scanner scanMsg = new Scanner(System.in);
        String mensagem = ipDestino + "|" + scanMsg.nextLine(); 
        
        PSsaida.println(mensagem);  
	}

}
